(function($){var j=$(window).width();var k=$(window).height();var m;$.doOnWindowResize=function(a){clearTimeout("doRes");m=setTimeout(function(){$(a).adjastPos();j=$(window).width();k=$(window).height()},400)};$.fn.adjastPos=function(a){var b=$(this).attr("options");if(!b.mantainOnWindow)return;if(!a)a=20;var c=$(window).width();var d=$(window).height();this.each(function(){if(($(this).offset().left+$(this).outerWidth())>c||($(this).offset().top+$(this).outerHeight())>d){var l=($(this).offset().left+$(this).outerWidth())>c?c-$(this).outerWidth()-a:$(this).offset().left;var t=($(this).offset().top+$(this).outerHeight())>d?d-$(this).outerHeight()-a:$(this).offset().top;t=(t>0)?t:0;$(this).animate({left:l,top:t},550)}})};jQuery.fn.buildContainers=function(f){var g=this;return this.each(function(){if($(this).is("[inited=true]"))return;this.options={containment:"document",elementsPath:"elements/",onCollapse:function(){},onBeforeIconize:function(){},onIconize:function(){},onClose:function(){},onResize:function(){},onDrag:function(){},onRestore:function(){},onLoad:function(){},mantainOnWindow:true,collapseEffect:"slide",effectDuration:300};$.extend(this.options,f);if(this.options.mantainOnWindow)$(window).resize(function(){$.doOnWindowResize(g)});var b=$(this);b.attr("inited","true");b.attr("iconized","false");b.attr("collapsed","false");b.attr("closed","false");b.attr("options",this.options);if($.metadata){$.metadata.setType("class");if(b.metadata().skin)b.attr("skin",b.metadata().skin);if(b.metadata().collapsed)b.attr("collapsed",b.metadata().collapsed);if(b.metadata().iconized)b.attr("iconized",b.metadata().iconized);if(b.metadata().icon)b.attr("icon",b.metadata().icon);if(b.metadata().buttons)b.attr("buttons",b.metadata().buttons);if(b.metadata().content)b.attr("content",b.metadata().content);if(b.metadata().aspectRatio)b.attr("aspectRatio",b.metadata().aspectRatio);if(b.metadata().grid)b.attr("grid",b.metadata().grid);if(b.metadata().gridx)b.attr("gridx",b.metadata().gridx);if(b.metadata().gridy)b.attr("gridy",b.metadata().gridy);if(b.metadata().handles)b.attr("handles",b.metadata().handles);if(b.metadata().dock)b.attr("dock",b.metadata().dock);if(b.metadata().closed)b.attr("closed",b.metadata().closed);if(b.metadata().width)b.attr("width",b.metadata().width);if(b.metadata().height)b.attr("height",b.metadata().height)}if(b.attr("content"))b.mb_changeContainerContent(b.attr("content"));b.addClass(b.attr("skin"));b.find(".n:first").attr("unselectable","on");if(!b.find(".n:first").html())b.find(".n:first").html("&nbsp;");b.containerSetIcon(b.attr("icon"),this.options.elementsPath);if(b.attr("buttons"))b.containerSetButtons(b.attr("buttons"),this.options);b.css({width:"99.9%"});if(b.attr("width")){var c=$.browser.msie?b.attr("width"):b.attr("width")+"px";b.css({width:c})}if(b.attr("height")){b.find(".c:first , .mbcontainercontent:first").css("height",b.attr("height")-b.find(".n:first").outerHeight()-(b.find(".s:first").outerHeight()))}if(b.hasClass("draggable")){var d=this.options.containment=="parent"?"relative":"absolute";b.css({position:d,margin:0});b.find(".n:first").css({cursor:"move"});b.mb_BringToFront();b.draggable({handle:".n:first",delay:0,containment:this.options.containment,stop:function(){var a=$(this).attr("options");if(a.onDrag)a.onDrag($(this))}});if(b.attr("grid")||(b.attr("gridx")&&b.attr("gridy"))){var e=b.attr("grid")?[b.attr("grid"),b.attr("grid")]:[b.attr("gridx"),b.attr("gridy")];b.draggable('option','grid',e)}b.bind("mousedown",function(){$(this).mb_BringToFront()})}if(b.hasClass("resizable")){b.containerResize()}if(b.attr("collapsed")=="true"){b.attr("collapsed","false");b.containerCollapse(this.options)}if(b.attr("iconized")=="true"){b.attr("iconized","false");b.containerIconize(this.options)}if(b.attr("closed")=="true"){b.attr("closed","false");b.mb_close(this.options)}setTimeout(function(){var a=b.attr("options");if(a.onLoad){a.onLoad(b)}b.css("visibility","visible");b.adjastPos()},1000)})};jQuery.fn.containerResize=function(){var f=$(this).hasClass("draggable");var g=$(this).attr("handles")?$(this).attr("handles"):"s";var h=$(this).attr("aspectRatio")?$(this).attr("aspectRatio"):false;var i=$(this);$(this).resizable({handles:f?"":g,aspectRatio:h,minWidth:350,minHeight:150,iframeFix:true,helper:"mbproxy",start:function(e,o){$(i).resizable('option','maxHeight',$(window).height()-($(i).offset().top)-5);$(i).resizable('option','maxWidth',$(window).width()-$(i).offset().left-5);o.helper.mb_BringToFront()},stop:function(){var a=$(this);var b=a.outerHeight()-$(this).find(".n:first").outerHeight()-($(this).find(".s:first").outerHeight());$(this).find(".c:first , .mbcontainercontent:first").css({height:b});if(!f&&!$(this).attr("handles")){var c=$(this).attr("width")&&$(this).attr("width")>0?$(this).attr("width"):"99.9%";$(this).css({width:c})}var d=$(this).attr("options");if(d.onResize)d.onResize(i)}});$(this).resizable('option','maxHeight',$("document").outerHeight()-($(this).offset().top+$(this).outerHeight())-10);$(this).find(".ui-resizable-n").addClass("mb-resize").addClass("mb-resize-resizable-n");$(this).find(".ui-resizable-e").addClass("mb-resize").addClass("mb-resize-resizable-e");$(this).find(".ui-resizable-w").addClass("mb-resize").addClass("mb-resize-resizable-w");$(this).find(".ui-resizable-s").addClass("mb-resize").addClass("mb-resize-resizable-s");$(this).find(".ui-resizable-se").addClass("mb-resize").addClass("mb-resize-resizable-se")};jQuery.fn.containerSetIcon=function(a,b){if(a&&a!=""){$(this).find(".ne:first").prepend("<img class='icon' src='"+b+"icons/"+a+"' style='position:absolute'/>");$(this).find(".n:first").css({paddingLeft:25})}else{$(this).find(".n:first").css({paddingLeft:0})}};jQuery.fn.containerSetButtons=function(a,b){if(!b)b=$(this).attr("options");var c=b.elementsPath;var d=$(this);if(a!=""){var e=a.split(",");$(this).find(".ne:first").append("<div class='buttonBar'></div>");for(var i in e){if(e[i]=="c"){$(this).find(".buttonBar:first").append("<img src='"+c+$(this).attr('skin')+"/close.png' class='close'/>");$(this).find(".close:first").bind("click",function(){d.mb_close();if(b.onClose)b.onClose(d)})}if(e[i]=="m"){$(this).find(".buttonBar:first").append("<img src='"+c+$(this).attr('skin')+"/min.png' class='collapsedContainer'/>");$(this).find(".collapsedContainer:first").bind("click",function(){d.containerCollapse(b)});$(this).find(".n:first").bind("dblclick",function(){d.containerCollapse(b)})}if(e[i]=="p"){$(this).find(".buttonBar:first").append("<img src='"+c+$(this).attr('skin')+"/print.png' class='printContainer'/>");$(this).find(".printContainer:first").bind("click",function(){})}if(e[i]=="i"){$(this).find(".buttonBar:first").append("<img src='"+c+$(this).attr('skin')+"/iconize.png' class='iconizeContainer'/>");$(this).find(".iconizeContainer:first").bind("click",function(){d.containerIconize(b)})}}var f=$.browser.mozilla||$.browser.safari;if(f)$(this).find(".buttonBar:first img").css({opacity:.5,cursor:"pointer","mozUserSelect":"none","khtmlUserSelect":"none"}).mouseover(function(){$(this).fadeTo(200,1)}).mouseout(function(){if(f)$(this).fadeTo(200,.5)});$(this).find(".buttonBar:first img").attr("unselectable","on")}};jQuery.fn.containerCollapse=function(b){this.each(function(){if(!b)b=$(this).attr("options");var a=$(this);if(!$(this).mb_getState("collapsed")){a.attr("w",a.outerWidth());a.attr("h",a.outerHeight());if(b.collapseEffect=="fade")a.find(".o:first").fadeOut(b.effectDuration,function(){});else{a.find(".icon:first").hide();a.find(".o:first").slideUp(b.effectDuration,function(){});a.animate({height:a.find(".n:first").outerHeight()+a.find(".s:first").outerHeight()},b.effectDuration,function(){a.find(".icon:first").show()})}a.attr("collapsed","true");a.find(".collapsedContainer:first").attr("src",b.elementsPath+$(this).attr('skin')+"/max.png");a.resizable("disable");if(b.onCollapse)b.onCollapse(a)}else{if(b.collapseEffect=="fade")a.find(".o:first").fadeIn(b.effectDuration,function(){});else{a.find(".o:first").slideDown(b.effectDuration,function(){});a.find(".icon:first").hide();a.animate({height:a.attr("h")},b.effectDuration,function(){a.find(".icon:first").show()})}if(a.hasClass("resizable"))a.resizable("enable");a.attr("collapsed","false");a.find(".collapsedContainer:first").attr("src",b.elementsPath+$(this).attr('skin')+"/min.png");a.find(".mbcontainercontent:first").css("overflow","auto")}})};jQuery.fn.containerIconize=function(e){if(!e)e=$(this).attr("options");return this.each(function(){if(e.onBeforeIconize)e.onBeforeIconize();var b=$(this);b.attr("iconized","true");if(b.attr("collapsed")=="false"){b.attr("h",b.outerHeight())}b.attr("w",b.attr("width")&&b.attr("width")>0?(!b.hasClass("resizable")?b.attr("width"):b.width()):!$(this).attr("handles")?"99.9%":b.width());b.attr("t",b.css("top"));b.attr("l",b.css("left"));b.resizable("disable");var l=0;var t=b.css("top");var c=b;if(b.attr("dock")){c=$("#"+b.attr("dock"));var d=c.find("img").size();l=$("#"+b.attr("dock")).offset().left+(32*d);t=$("#"+b.attr("dock")).offset().top};this.dockIcon=$("<img src='"+e.elementsPath+"icons/"+(b.attr("icon")?b.attr("icon"):"restore.png")+"' class='restoreContainer' width='32'/>").appendTo(c).css("cursor","pointer").hide().attr("contTitle",b.find(".n:first").text()).bind("click",function(){b.attr("iconized","false");if(b.is(".draggable"))b.css({top:$(this).offset().top,left:$(this).offset().left});else b.css({left:"auto",top:"auto"});b.show();if(!$.browser.msie){b.find(".no:first").fadeIn("fast");if(b.attr("collapsed")=="false"){b.animate({height:b.attr("h"),width:b.attr("w"),left:b.attr("l"),top:b.attr("t")},e.effectDuration,function(){b.find(".mbcontainercontent:first").css("overflow","auto");if(b.hasClass("draggable")){b.mb_BringToFront()}});b.find(".c:first , .mbcontainercontent:first").css("height",b.attr("h")-b.find(".n:first").outerHeight()-(b.find(".s:first").outerHeight()))}else b.animate({height:"60px",width:b.attr("w"),left:b.attr("l"),top:b.attr("t")},e.effectDuration)}else{b.find(".no:first").show();if(b.attr("collapsed")=="false"){b.css({height:b.attr("h"),width:b.attr("w"),left:b.attr("l"),top:b.attr("t")},e.effectDuration);b.find(".c:first , .mbcontainercontent:first").css("height",b.attr("h")-b.find(".n:first").outerHeight()-(b.find(".s:first").outerHeight()))}else b.css({height:"60px",width:b.attr("w"),left:b.attr("l"),top:b.attr("t")},e.effectDuration)}if(b.hasClass("resizable")&&b.attr("collapsed")=="false")b.resizable("enable");$(this).remove();if(b.hasClass("draggable"))b.mb_BringToFront();$(".iconLabel").remove();b.attr("restored",true);if(e.onRestore)e.onRestore(b);if(e.mantainOnWindow)$.doOnWindowResize(b)}).bind("mouseenter",function(){var a="<div class='iconLabel'>"+$(this).attr("contTitle")+"</div>";$("body").append(a);$(".iconLabel").hide().css({position:"absolute",top:$(this).offset().top-20,left:$(this).offset().left+15,opacity:.9}).fadeIn("slow").mb_BringToFront()}).bind("mouseleave",function(){$(".iconLabel").fadeOut("fast",function(){$(this).remove()})});if(!$.browser.msie){b.find(".mbcontainercontent:first").css("overflow","hidden");b.find(".no:first").slideUp("fast");b.animate({height:"32px",width:"32px",left:l,top:t},e.effectDuration,function(){$(this.dockIcon).show();if(b.attr("dock"))b.hide()})}else{b.find(".no:first").hide();b.css({height:"32px",width:"32px",left:l,top:t});$(this.dockIcon).show();if(b.attr("dock"))b.hide()}if(e.onIconize)e.onIconize(b)})};jQuery.fn.mb_resizeTo=function(h,w,b){if(b||b==undefined)b=200;else b=0;var c=$(this);if(!w)w=$(this).outerWidth();if(!h)h=$(this).outerHeight();if($(this).mb_getState('closed')||$(this).mb_getState('iconized')){$(this).attr("w",w);$(this).attr("h",h);return}var d=h-$(this).find(".n:first").outerHeight()-($(this).find(".s:first").outerHeight());$(this).find(".c:first , .mbcontainercontent:first").animate({height:d},b);$(this).animate({"height":h,"width":w},b,function(){$(this).adjastPos();var a=$(this).attr("options");if(a.onResize)a.onResize(c)})};jQuery.fn.mb_iconize=function(){var a=$(this).get(0);if($(this).attr("closed")=="false"){if($(this).attr("iconized")=="true"){var b=$(this)[0].dockIcon;$(b).click();$(this).mb_BringToFront()}else{$(this).containerIconize();if(a.options.onIconize)a.options.onIconize($(a))}}return $(this).mb_getState("iconized")};jQuery.fn.mb_open=function(a,b){var t=Math.floor($(this).attr("t"));var l=Math.floor($(this).attr("l"));$(this).css("top",t).css("left",l);var c=$(this).get(0);if($(this).attr("closed")=="true"){if(a){if(!b)b="";$(this).mb_changeContainerContent(a,b)}if(!$.browser.msie)$(this).fadeIn(300);else $(this).show();$(this).attr("closed","false");$(this).mb_BringToFront();$(c).attr("restored",true);if(!$(this).mb_getState("collapsed")){$(this).mb_resizeTo($(this).attr("h"),$(this).attr("w"),false)}if(c.options.onRestore)c.options.onRestore($(c))}return $(this)};jQuery.fn.mb_close=function(){var a=$(this).get(0);if($(this).attr("closed")=="false"&&$(this).attr("iconized")=="false"){$(this).attr("closed","true");if($(this).attr("collapsed")=="false"){$(this).attr("w",$(this).outerWidth());$(this).attr("h",$(this).outerHeight());$(this).attr("t",$(this).offset().top);$(this).attr("l",$(this).offset().left)}if(!$.browser.msie)$(this).fadeOut(300);else $(this).hide()}if(a.options.onClose)a.options.onClose($(a));return $(this)};jQuery.fn.mb_toggle=function(){if($(this).attr("closed")=="false"&&$(this).attr("iconized")=="false"){$(this).containerCollapse()}return $(this)};jQuery.fn.mb_BringToFront=jQuery.fn.mb_bringToFront=function(){var b=10;$('*').each(function(){if($(this).css("position")=="absolute"){var a=parseInt($(this).css('zIndex'));b=a>b?parseInt($(this).css('zIndex')):b}});$(this).css('zIndex',b+=1);return b};jQuery.fn.mb_changeContent=function(b,c){var d=$(this);if(!c)c="";$.ajax({type:"POST",url:b,data:c,success:function(a){d.html(a)}})};jQuery.fn.mb_changeContainerContent=function(a,b){$(this).find(".mbcontainercontent:first").mb_changeContent(a,b)};jQuery.fn.mb_getState=function(a){var b=$(this).attr(a);b=b=="true";return b};jQuery.fn.mb_fullscreen=function(){if($(this).is("[iconized='true']")||$(this).is("[collapsed='true']")||$(this).is("[closed='true']")){$(this).attr("w",$(window).width()-40);$(this).attr("h",$(window).height()-40);$(this).attr("t",20);$(this).attr("l",20);$(this).css("height","");return}$(this).animate({top:20,left:20,position:"relative"},200);$(this).mb_resizeTo($(window).height()-40,$(window).width()-40);$(this).attr("w",$(this).outerWidth());$(this).attr("h",$(this).outerHeight());$(this).attr("t",$(this).offset().top);$(this).attr("l",$(this).offset().left);$(this).css("height","");$(this).mb_bringToFront();return $(this)};jQuery.fn.mb_centerOnWindow=function(a){var b=$(window).width();var c=$(window).height();var d=$(this).outerWidth();var e=$(this).outerHeight();var l=(b-d)/2;var t=(c-e)/2;if(a)$(this).animate({top:t,left:l});else $(this).css({top:t,left:l})}})(jQuery);